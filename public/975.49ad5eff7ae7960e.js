"use strict";(self.webpackChunkMercado=self.webpackChunkMercado||[]).push([[975],{4975:(it,h,a)=>{a.r(h),a.d(h,{ClientModule:()=>et});var c=a(9808),p=a(3075),Z=a(9764),y=a(6234),d=a(1083),b=a(5226),C=a.n(b),t=a(5e3),g=a(7192),l=a(9097),u=a(7093),_=a(4834),v=a(9224),T=a(773),f=a(7423),A=a(5245),M=a(4106),O=a(7531);function I(e,i){1&e&&(t.TgZ(0,"div"),t._UZ(1,"mat-spinner"),t.qZA())}function U(e,i){if(1&e&&t._UZ(0,"img",10),2&e){const o=t.oxw();t.s9C("src",o.imagen,t.LSH)}}function F(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"div",8)(1,"h2"),t._uU(2," Unidades: "),t.TgZ(3,"h5"),t._uU(4),t.qZA(),t.TgZ(5,"button",11),t.NdJ("click",function(){t.CHM(o);const r=t.oxw();return r.editar(r.producto.name)}),t.TgZ(6,"mat-icon"),t._uU(7,"edit"),t.qZA()()(),t.TgZ(8,"h4"),t._uU(9," Disponibles: "),t.TgZ(10,"h5"),t._uU(11),t.qZA()()()}if(2&e){const o=t.oxw();t.xp6(4),t.Oqu(o.usuario.carrito[o.index].unidades),t.xp6(7),t.Oqu(o.producto.stock)}}function P(e,i){1&e&&(t.TgZ(0,"span",18),t._uU(1," * Las unidades tienen que ser entre 1 y el stock disponible "),t.qZA())}function S(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"div",8)(1,"div",12)(2,"h2"),t._uU(3,"Unidades:"),t.qZA(),t.TgZ(4,"form",13,14),t.NdJ("ngSubmit",function(){t.CHM(o);const r=t.oxw();return r.guardar(r.producto._id)}),t.TgZ(6,"mat-form-field")(7,"input",15),t.NdJ("ngModelChange",function(r){t.CHM(o);const s=t.oxw();return s.usuario.carrito[s.index].unidades=r}),t.qZA()(),t.TgZ(8,"button",16)(9,"mat-icon"),t._uU(10,"done"),t.qZA()()(),t.YNc(11,P,2,0,"span",17),t.qZA(),t.TgZ(12,"h4"),t._uU(13," Disponibles:h5 "),t.TgZ(14,"h5"),t._uU(15),t.qZA()()()}if(2&e){const o=t.MAs(5),n=t.oxw();t.xp6(7),t.s9C("max",n.producto.stock),t.Q6J("ngModel",n.usuario.carrito[n.index].unidades),t.xp6(1),t.Q6J("disabled",o.invalid),t.xp6(3),t.Q6J("ngIf",o.invalid),t.xp6(4),t.Oqu(n.producto.stock)}}let L=(()=>{class e{constructor(o,n){this.authService=o,this.productosService=n,this.price=new t.vpe,this.editarHabilitado=!1,this.editarr=""}ngOnInit(){this.usuario=this.authService.usuario,this.buscarImagen(),this.buscarEnCarrito(),this.verPrecio()}buscarImagen(){this.productosService.getImagen(this.producto.img).subscribe(o=>{this.imagen=o.fileUrl})}buscarEnCarrito(){this.index=this.usuario.carrito.findIndex(o=>o._id==this.producto._id)}editar(o){this.editarr=o}guardar(o){this.editarr="";let n=this.usuario.carrito.findIndex(x=>x._id==o);const r=this.usuario.carrito[n];r.unidades=this.usuario.carrito[n].unidades,r.precio=r.unidades*this.producto.price,this.verPrecio();const s={name:this.usuario.name,email:this.usuario.email,carrito:[r]};this.editarHabilitado=!1,this.productosService.editarUnidadesCarrito(this.usuario.uid,s).subscribe()}eliminar(o){this.productosService.EliminarDelCarrito(this.usuario.uid,{name:this.usuario.name,email:this.usuario.email,carrito:[{IDproducto:o,unidades:0,_id:o,precio:0}]}).subscribe(r=>{this.authService.validarToken().subscribe(s=>this.productosService.usuario$.emit(o))})}verPrecio(){this.price.emit({precio:this.usuario.carrito[this.index].precio,index:this.posicion})}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(g.e),t.Y36(l.k))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-tarjeta-carrito"]],inputs:{producto:"producto",posicion:"posicion"},outputs:{price:"price"},decls:26,vars:12,consts:[["fxFlex","100","fxLayout","row wrap"],["fxFlex","30","fxFlex.xs","100"],[4,"ngIf","ngIfElse"],["divImg",""],["fxFlex","70","fxFlex.xs","100","fxLayout","row wrap",1,"container"],["fxFlex","100"],["fxFlex","50","fxFlex.xs","100",4,"ngIf","ngIfElse"],["divForm",""],["fxFlex","50","fxFlex.xs","100"],["mat-button","",1,"eliminar",3,"click"],["alt","",3,"src"],["mat-mini-fab","",3,"click"],["fxLayout","row wrap"],[3,"ngSubmit"],["miFormulario","ngForm"],["matInput","","type","number","name","unidades","required","","min","1",1,"form-control",3,"ngModel","max","ngModelChange"],["mat-mini-fab","","type","submit",3,"disabled"],["class","error","fxFlex","100",4,"ngIf"],["fxFlex","100",1,"error"]],template:function(o,n){if(1&o&&(t.TgZ(0,"mat-card")(1,"div",0)(2,"div",1),t.YNc(3,I,2,0,"div",2),t.YNc(4,U,1,1,"ng-template",null,3,t.W1O),t.qZA(),t.TgZ(6,"div",4)(7,"h1",5),t._uU(8),t.qZA(),t.YNc(9,F,12,2,"div",6),t.YNc(10,S,16,5,"ng-template",null,7,t.W1O),t.TgZ(12,"div",8)(13,"h2"),t._uU(14," Precio: "),t.TgZ(15,"h5"),t._uU(16),t.ALo(17,"currency"),t.qZA()(),t.TgZ(18,"h2"),t._uU(19," Total: "),t.TgZ(20,"h5"),t._uU(21),t.ALo(22,"currency"),t.qZA()()(),t.TgZ(23,"div",5)(24,"button",9),t.NdJ("click",function(){return n.eliminar(n.producto._id)}),t._uU(25," Eliminar "),t.qZA()()()()()),2&o){const r=t.MAs(5),s=t.MAs(11);t.xp6(3),t.Q6J("ngIf",!n.imagen)("ngIfElse",r),t.xp6(5),t.Oqu(n.producto.name),t.xp6(1),t.Q6J("ngIf",n.editarr!=n.producto.name)("ngIfElse",s),t.xp6(7),t.AsE(" ",n.usuario.carrito[n.index].unidades," x ",t.lcZ(17,8,n.producto.price)," "),t.xp6(5),t.hij(" ",t.lcZ(22,10,n.usuario.carrito[n.index].precio)," ")}},directives:[v.a8,u.yH,u.xw,c.O5,T.Ou,f.lW,A.Hw,p._Y,p.JL,p.F,M.KE,O.Nt,p.qQ,p.wV,p.Fd,p.Fj,p.Q7,p.JJ,p.On],pipes:[c.H9],styles:[".container[_ngcontent-%COMP%]{padding-left:15px;font-family:Cormorant Garamond,serif!important}.error[_ngcontent-%COMP%]{color:red;font-weight:400;font-family:Trebuchet MS,Lucida Sans Unicode,Lucida Grande,Lucida Sans,Arial,sans-serif}.eliminar[_ngcontent-%COMP%]{background-color:#cf0000;color:#fff}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h4[_ngcontent-%COMP%]{display:flex;align-items:center;margin-block:0px;margin-bottom:10px}h5[_ngcontent-%COMP%]{display:flex;align-items:flex-end;margin-block:0px;margin-left:10px;font-size:20px;font-family:Trebuchet MS,Lucida Sans Unicode,Lucida Grande,Lucida Sans,Arial,sans-serif}img[_ngcontent-%COMP%]{width:100%;height:auto}.mat-mini-fab.mat-accent[_ngcontent-%COMP%]{background-color:#6016fd;margin-left:10px}mat-form-field[_ngcontent-%COMP%]{max-width:60px}"]}),e})();function j(e,i){1&e&&(t.TgZ(0,"div",1)(1,"h1",5),t._uU(2,"Su carrito esta vacio"),t.qZA()())}function w(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"div")(1,"app-tarjeta-carrito",9),t.NdJ("price",function(r){return t.CHM(o),t.oxw(2).precioTotal(r)}),t.qZA(),t._UZ(2,"mat-divider"),t.qZA()}if(2&e){const o=i.$implicit,n=i.index;t.xp6(1),t.Q6J("producto",o)("posicion",n)}}function H(e,i){if(1&e){const o=t.EpF();t.YNc(0,w,3,2,"div",6),t.TgZ(1,"h2",7),t._uU(2," Total: "),t.TgZ(3,"h5"),t._uU(4),t.ALo(5,"currency"),t.qZA()(),t.TgZ(6,"button",8),t.NdJ("click",function(){return t.CHM(o),t.oxw().comprar()}),t._uU(7,"Comprar"),t.qZA()}if(2&e){const o=t.oxw();t.Q6J("ngForOf",o.productos),t.xp6(4),t.hij(" ",t.lcZ(5,2,o.priceTotal)," ")}}let J=(()=>{class e{constructor(o,n,r){this.router=o,this.authService=n,this.productosService=r,this.productos=[],this.confirmacion=!1,this.editarHabilitado=!1,this.editarr="",this.total=[],this.priceTotal=0}ngOnInit(){this.productosService.usuario$.subscribe(o=>{this.usuario=this.authService.usuario,this.index=this.productos.findIndex(n=>n._id==o),this.productos.splice(this.index,1),this.total.splice(this.index,1),this.sumarPrecios()}),this.usuario=this.authService.usuario,this.buscarProductos()}buscarProductos(){this.usuario.carrito.map(o=>{this.productosService.getProductoID(o.IDproducto).subscribe(n=>{this.productos.push(n)})})}comprar(){this.productosService.procesarCompra(this.usuario.uid,this.usuario).subscribe(o=>{!0===o.ok&&(this.usuario.precio=this.priceTotal,this.productosService.agregarCompra(this.usuario.uid,this.usuario).subscribe(n=>{this.authService.validarToken().subscribe(),this.productosService.vaciarCarrito(this.usuario.uid,this.usuario).subscribe(r=>this.router.navigateByUrl("/home/compras"))})),C().fire({icon:"success",text:"Compra realizada con exito!"})},o=>{C().fire({icon:"error",title:"Oops...",text:o.error.msg})})}precioTotal(o){this.total[o.index]=o.precio,this.sumarPrecios()}sumarPrecios(){this.priceTotal=this.total.reduce((o,n)=>o+n,0)}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(d.F0),t.Y36(g.e),t.Y36(l.k))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-carrito"]],decls:8,vars:2,consts:[["fxLayout","column",1,"container"],["fxLayoutAlign","center"],["fxLayout","column"],["fxLayoutAlign","center",4,"ngIf","ngIfElse"],["divProducto",""],["fxLayoutAlign","center center"],[4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","center center"],["mat-button","",1,"comprar",3,"click"],[3,"producto","posicion","price"]],template:function(o,n){if(1&o&&(t.TgZ(0,"div",0)(1,"h1",1),t._uU(2,"Carrito"),t.qZA(),t._UZ(3,"mat-divider"),t.TgZ(4,"div",2),t.YNc(5,j,3,0,"div",3),t.YNc(6,H,8,4,"ng-template",null,4,t.W1O),t.qZA()()),2&o){const r=t.MAs(7);t.xp6(5),t.Q6J("ngIf",0==n.productos.length)("ngIfElse",r)}},directives:[u.xw,u.Wh,_.d,c.O5,c.sg,L,f.lW],pipes:[c.H9],styles:[".container[_ngcontent-%COMP%]{background-color:#fff;margin:15px;border-radius:10px}.comprar[_ngcontent-%COMP%]{margin-top:10px;background-color:#6016fd;color:#fff}img[_ngcontent-%COMP%]{width:150px;height:150px}mat-divider[_ngcontent-%COMP%]{width:100%}h2[_ngcontent-%COMP%]{margin-block:0px;margin:10px;padding-right:10%}h5[_ngcontent-%COMP%]{display:flex;align-items:flex-end;margin-block:0px;margin-left:10px;font-size:20px;font-family:Trebuchet MS,Lucida Sans Unicode,Lucida Grande,Lucida Sans,Arial,sans-serif}"]}),e})();var N=a(8512),m=a(1125),Y=a(4766);function E(e,i){1&e&&(t.TgZ(0,"div"),t._UZ(1,"mat-spinner"),t.qZA())}function D(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"mat-card",2)(1,"h4",3),t._uU(2),t.qZA(),t.TgZ(3,"button",4),t.NdJ("click",function(){return t.CHM(o),t.oxw().verProducto()})("auxclick",function(){return t.CHM(o),t.oxw().otraPestana()}),t._uU(4," Ver Producto "),t.qZA(),t.TgZ(5,"span"),t._uU(6),t.ALo(7,"i18nPlural"),t.ALo(8,"currency"),t.qZA()()}if(2&e){const o=t.oxw();t.xp6(2),t.Oqu(o.producto.name),t.xp6(4),t.AsE(" ",t.xi3(7,3,o.ID.unidades,o.ProductoMapa)," | ",t.lcZ(8,6,o.producto.price*o.ID.unidades)," ")}}let q=(()=>{class e{constructor(o,n){this.router=o,this.productosServices=n,this.ProductoMapa={"=1":"1 producto",other:"# productos"},this.url=Y.N.baseUrl+"/home"}ngOnInit(){this.productosServices.getProductoID(this.ID.IDproducto).subscribe(o=>{this.producto=o})}verProducto(){this.router.navigateByUrl(`home/${this.producto.categoria}/${this.producto.name}`)}otraPestana(){window.open(`http://localhost:4200/home/${this.producto.categoria}/${this.producto.name}`,"_blank")}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(d.F0),t.Y36(l.k))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-tarjeta-compras"]],inputs:{ID:"ID"},decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["divPro",""],["fxLayout","row","fxFlex","100",1,"producto"],["fxFlex","30"],["mat-button","",1,"button",3,"click","auxclick"]],template:function(o,n){if(1&o&&(t.YNc(0,E,2,0,"div",0),t.YNc(1,D,9,8,"ng-template",null,1,t.W1O)),2&o){const r=t.MAs(2);t.Q6J("ngIf",!n.producto)("ngIfElse",r)}},directives:[c.O5,T.Ou,v.a8,u.xw,u.yH,f.lW],pipes:[c.Gx,c.H9],styles:['h4[_ngcontent-%COMP%]{margin-block:0}span[_ngcontent-%COMP%]{max-width:50%}@media (max-width: 550px){.button[_ngcontent-%COMP%]{max-width:35%!important;padding:0!important}span[_ngcontent-%COMP%]{max-width:32%;margin-left:12px}}.producto[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.mat-card[_ngcontent-%COMP%]:not([class*="mat-elevation-z"]){box-shadow:0 2px 1px 3px #0003,0 1px 1px 1px #00000024,0 1px 3px 1px #0000001f!important}.button[_ngcontent-%COMP%]{max-width:20%;color:#3c00bb;font-weight:700;display:flex;justify-content:center}']}),e})();function k(e,i){1&e&&(t.TgZ(0,"div",2)(1,"h1"),t._uU(2,"No tiene compras realizadas"),t.qZA()())}function Q(e,i){if(1&e&&(t.TgZ(0,"div"),t._UZ(1,"app-tarjeta-compras",13),t.qZA()),2&e){const o=i.$implicit;t.xp6(1),t.Q6J("ID",o)}}function W(e,i){if(1&e&&(t.TgZ(0,"div",8)(1,"mat-expansion-panel",9)(2,"mat-expansion-panel-header")(3,"mat-panel-title",10),t._uU(4),t.ALo(5,"date"),t.qZA(),t.TgZ(6,"mat-panel-description",11),t._uU(7),t.ALo(8,"i18nPlural"),t.ALo(9,"currency"),t.qZA()(),t.TgZ(10,"div"),t.YNc(11,Q,2,1,"div",12),t.qZA()()()),2&e){const o=i.$implicit,n=i.index,r=t.oxw(2);t.xp6(4),t.hij(" Fecha: ",t.xi3(5,5,o.fecha,"d/M/yy, H:mm ")," "),t.xp6(3),t.lnq(" ",r.verUnidades(n,o)," ",t.xi3(8,8,r.unidades[n],r.compraMapa)," | ",t.lcZ(9,11,o.precio)," "),t.xp6(4),t.Q6J("ngForOf",o.compra)}}function z(e,i){if(1&e&&(t.TgZ(0,"div",6),t.YNc(1,W,12,13,"div",7),t.qZA()),2&e){const o=t.oxw();t.xp6(1),t.Q6J("ngForOf",o.compras)}}let $=(()=>{class e{constructor(o,n){this.authService=o,this.productosServices=n,this.compras=[],this.productos=[],this.index=0,this.unidades=[],this.compraMapa={"=1":"1 producto",other:"# productos"}}ngOnInit(){this.usuario=Object.assign({},this.authService.usuario),this.buscarCompras(),this.compras.reverse()}buscarCompras(){var o;null===(o=this.usuario.compras)||void 0===o||o.map(n=>this.compras.push(n))}buscarProductos(o){o.compra.map(n=>{let r=this.productos.findIndex(s=>s._id==n.IDproducto);-1!=r?this.index=r:this.productosServices.getProductoID(n.IDproducto).subscribe(s=>{this.productos.push(s);let x=this.productos.findIndex(nt=>nt._id==n.IDproducto);this.index=x})})}verUnidades(o,n){let r=0;n.compra.map(s=>{r+=s.unidades}),this.unidades[o]=r}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(g.e),t.Y36(l.k))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-compras"]],decls:9,vars:2,consts:[["fxLayoutAlign","center center"],["fxLayout","column","fxFlex.xs","100","fxFlex.sm","70","fxFlex","55",1,"container"],["fxLayoutAlign","center"],["fxLayout","column"],["fxLayoutAlign","center",4,"ngIf","ngIfElse"],["divCompra",""],["fxLayout","row wrap","fxLayoutAlign","center center","fxFlex","100",1,"pepe"],["fxFlex","100",4,"ngFor","ngForOf"],["fxFlex","100"],["hideToggle",""],["fxFlex","40"],["fxFlex","60"],[4,"ngFor","ngForOf"],[3,"ID"]],template:function(o,n){if(1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h1",2),t._uU(3,"Compras"),t.qZA(),t._UZ(4,"mat-divider"),t.TgZ(5,"div",3),t.YNc(6,k,3,0,"div",4),t.YNc(7,z,2,1,"ng-template",null,5,t.W1O),t.qZA()()()),2&o){const r=t.MAs(8);t.xp6(6),t.Q6J("ngIf",0==n.compras.length)("ngIfElse",r)}},directives:[u.Wh,u.xw,u.yH,_.d,c.O5,c.sg,m.ib,m.yz,m.yK,m.u4,q],pipes:[c.uU,c.Gx,c.H9],styles:[".container[_ngcontent-%COMP%]{background-color:#fff;margin:10px 0;border-radius:10px}mat-panel-description[_ngcontent-%COMP%]{color:#000000d6}"]}),e})(),X=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-home-categoria"]],decls:1,vars:0,template:function(o,n){1&o&&t._UZ(0,"router-outlet")},directives:[d.lC],encapsulation:2}),e})();var B=a(1170);let G=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-home"]],decls:2,vars:0,template:function(o,n){1&o&&t._UZ(0,"app-menu")(1,"router-outlet")},directives:[B.M,d.lC],encapsulation:2}),e})();var R=a(3218),K=a(8325);const V=[{path:"",component:G,children:[{path:"carrito",component:J},{path:"compras",component:$},{path:":name",component:X,children:[{path:"",component:R.n},{path:":name",component:K.g}]},{path:"",component:N.p}]}];let tt=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[d.Bz.forChild(V)],d.Bz]}),e})();var ot=a(9258);let et=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[tt,c.ez,ot.K,Z.o9,p.u5,y.q,p.UX]]}),e})()}}]);