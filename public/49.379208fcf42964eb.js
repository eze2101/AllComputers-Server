"use strict";(self.webpackChunkMercado=self.webpackChunkMercado||[]).push([[49],{2049:(rt,x,a)=>{a.r(x),a.d(x,{ClientModule:()=>it});var c=a(9808),Z=a(9764),y=a(6234),d=a(1083),b=a(8325),A=a(8512),t=a(5e3),F=a(1170);let M=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-home"]],decls:2,vars:0,template:function(o,i){1&o&&t._UZ(0,"app-menu")(1,"router-outlet")},directives:[F.M,d.lC],styles:[""]}),e})();var O=a(3218),l=a(9097);let I=(()=>{class e{constructor(o,i){this.productoService=o,this.router=i,this.productos=[],this.prodXcate=[]}ngOnInit(){}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(l.k),t.Y36(d.F0))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-listado"]],decls:1,vars:0,template:function(o,i){1&o&&t._UZ(0,"router-outlet")},directives:[d.lC],styles:["body[_ngcontent-%COMP%]{background-color:brown}"]}),e})();var U=a(5226),C=a.n(U),f=a(7192),p=a(7093),v=a(4834),_=a(9224),T=a(773),g=a(7423),P=a(5245),u=a(3075),S=a(4106),L=a(7531);const j=["miFormulario"];function H(e,r){1&e&&(t.TgZ(0,"div"),t._UZ(1,"mat-spinner"),t.qZA())}function Y(e,r){if(1&e&&t._UZ(0,"img",10),2&e){const o=t.oxw();t.s9C("src",o.imagen,t.LSH)}}function w(e,r){if(1&e){const o=t.EpF();t.TgZ(0,"div",8)(1,"h2"),t._uU(2," Unidades: "),t.TgZ(3,"h5"),t._uU(4),t.qZA(),t.TgZ(5,"button",11),t.NdJ("click",function(){t.CHM(o);const n=t.oxw();return n.editar(n.producto.name)}),t.TgZ(6,"mat-icon"),t._uU(7,"edit"),t.qZA()()(),t.TgZ(8,"h4"),t._uU(9," Disponibles: "),t.TgZ(10,"h5"),t._uU(11),t.qZA()()()}if(2&e){const o=t.oxw();t.xp6(4),t.Oqu(o.usuario.carrito[o.index].unidades),t.xp6(7),t.Oqu(o.producto.stock)}}function J(e,r){1&e&&(t.TgZ(0,"span",18),t._uU(1," * Las unidades tienen que ser entre 1 y el stock disponible "),t.qZA())}function N(e,r){if(1&e){const o=t.EpF();t.TgZ(0,"div",8)(1,"div",12)(2,"h2"),t._uU(3,"Unidades:"),t.qZA(),t.TgZ(4,"form",13,14),t.NdJ("ngSubmit",function(){t.CHM(o);const n=t.oxw();return n.guardar(n.producto._id)}),t.TgZ(6,"mat-form-field")(7,"input",15),t.NdJ("ngModelChange",function(n){t.CHM(o);const s=t.oxw();return s.usuario.carrito[s.index].unidades=n}),t.qZA()(),t.TgZ(8,"button",16)(9,"mat-icon"),t._uU(10,"done"),t.qZA()()(),t.YNc(11,J,2,0,"span",17),t.qZA(),t.TgZ(12,"h4"),t._uU(13," Disponibles:h5 "),t.TgZ(14,"h5"),t._uU(15),t.qZA()()()}if(2&e){const o=t.MAs(5),i=t.oxw();t.xp6(7),t.s9C("max",i.producto.stock),t.Q6J("ngModel",i.usuario.carrito[i.index].unidades),t.xp6(1),t.Q6J("disabled",o.invalid),t.xp6(3),t.Q6J("ngIf",o.invalid),t.xp6(4),t.Oqu(i.producto.stock)}}let E=(()=>{class e{constructor(o,i,n){this.authService=o,this.productosService=i,this.router=n,this.price=new t.vpe,this.editarHabilitado=!1,this.editarr=""}ngOnInit(){this.usuario=this.authService.usuario,this.buscarImagen(),this.buscarEnCarrito(),this.verPrecio()}buscarImagen(){this.productosService.getImagen(this.producto.img).subscribe(o=>{this.imagen=o.fileUrl})}buscarEnCarrito(){this.index=this.usuario.carrito.findIndex(o=>o._id==this.producto._id)}editar(o){this.editarr=o}guardar(o){this.editarr="";let i=this.usuario.carrito.findIndex(h=>h._id==o);const n=this.usuario.carrito[i];n.unidades=this.usuario.carrito[i].unidades,n.precio=n.unidades*this.producto.price,this.verPrecio();const s={name:this.usuario.name,email:this.usuario.email,carrito:[n]};this.editarHabilitado=!1,this.productosService.editarUnidadesCarrito(this.usuario.uid,s).subscribe()}eliminar(o){this.productosService.EliminarDelCarrito(this.usuario.uid,{name:this.usuario.name,email:this.usuario.email,carrito:[{IDproducto:o,unidades:0,_id:o,precio:0}]}).subscribe(n=>{this.authService.validarToken().subscribe(s=>this.productosService.usuario$.emit(o))})}verPrecio(){this.price.emit({precio:this.usuario.carrito[this.index].precio,index:this.posicion})}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(f.e),t.Y36(l.k),t.Y36(d.F0))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-tarjeta-carrito"]],viewQuery:function(o,i){if(1&o&&t.Gf(j,5),2&o){let n;t.iGM(n=t.CRH())&&(i.miFormulario=n.first)}},inputs:{producto:"producto",posicion:"posicion"},outputs:{price:"price"},decls:26,vars:12,consts:[["fxFlex","100","fxLayout","row wrap"],["fxFlex","30","fxFlex.xs","100"],[4,"ngIf","ngIfElse"],["divImg",""],["fxFlex","70","fxFlex.xs","100","fxLayout","row wrap",1,"container"],["fxFlex","100"],["fxFlex","50","fxFlex.xs","100",4,"ngIf","ngIfElse"],["divForm",""],["fxFlex","50","fxFlex.xs","100"],["mat-button","",1,"eliminar",3,"click"],["alt","",3,"src"],["mat-mini-fab","",3,"click"],["fxLayout","row wrap"],[3,"ngSubmit"],["miFormulario","ngForm"],["matInput","","type","number","name","unidades","required","","min","1",1,"form-control",3,"ngModel","max","ngModelChange"],["mat-mini-fab","","type","submit",3,"disabled"],["class","error","fxFlex","100",4,"ngIf"],["fxFlex","100",1,"error"]],template:function(o,i){if(1&o&&(t.TgZ(0,"mat-card")(1,"div",0)(2,"div",1),t.YNc(3,H,2,0,"div",2),t.YNc(4,Y,1,1,"ng-template",null,3,t.W1O),t.qZA(),t.TgZ(6,"div",4)(7,"h1",5),t._uU(8),t.qZA(),t.YNc(9,w,12,2,"div",6),t.YNc(10,N,16,5,"ng-template",null,7,t.W1O),t.TgZ(12,"div",8)(13,"h2"),t._uU(14," Precio: "),t.TgZ(15,"h5"),t._uU(16),t.ALo(17,"currency"),t.qZA()(),t.TgZ(18,"h2"),t._uU(19," Total: "),t.TgZ(20,"h5"),t._uU(21),t.ALo(22,"currency"),t.qZA()()(),t.TgZ(23,"div",5)(24,"button",9),t.NdJ("click",function(){return i.eliminar(i.producto._id)}),t._uU(25," Eliminar "),t.qZA()()()()()),2&o){const n=t.MAs(5),s=t.MAs(11);t.xp6(3),t.Q6J("ngIf",!i.imagen)("ngIfElse",n),t.xp6(5),t.Oqu(i.producto.name),t.xp6(1),t.Q6J("ngIf",i.editarr!=i.producto.name)("ngIfElse",s),t.xp6(7),t.AsE(" ",i.usuario.carrito[i.index].unidades," x ",t.lcZ(17,8,i.producto.price)," "),t.xp6(5),t.hij(" ",t.lcZ(22,10,i.usuario.carrito[i.index].precio)," ")}},directives:[_.a8,p.yH,p.xw,c.O5,T.Ou,g.lW,P.Hw,u._Y,u.JL,u.F,S.KE,L.Nt,u.qQ,u.wV,u.Fd,u.Fj,u.Q7,u.JJ,u.On],pipes:[c.H9],styles:[".container[_ngcontent-%COMP%]{padding-left:15px;font-family:Cormorant Garamond,serif!important}.error[_ngcontent-%COMP%]{color:red;font-weight:400;font-family:Trebuchet MS,Lucida Sans Unicode,Lucida Grande,Lucida Sans,Arial,sans-serif}.eliminar[_ngcontent-%COMP%]{background-color:#cf0000;color:#fff}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h4[_ngcontent-%COMP%]{display:flex;align-items:center;margin-block:0px;margin-bottom:10px}h5[_ngcontent-%COMP%]{display:flex;align-items:flex-end;margin-block:0px;margin-left:10px;font-size:20px;font-family:Trebuchet MS,Lucida Sans Unicode,Lucida Grande,Lucida Sans,Arial,sans-serif}img[_ngcontent-%COMP%]{width:100%;height:auto}.mat-mini-fab.mat-accent[_ngcontent-%COMP%]{background-color:#6016fd;margin-left:10px}mat-form-field[_ngcontent-%COMP%]{max-width:60px}"]}),e})();const D=["miFormulario"];function Q(e,r){1&e&&(t.TgZ(0,"div",1)(1,"h1",5),t._uU(2,"Su carrito esta vacio"),t.qZA()())}function q(e,r){if(1&e){const o=t.EpF();t.TgZ(0,"div")(1,"app-tarjeta-carrito",9),t.NdJ("price",function(n){return t.CHM(o),t.oxw(2).precioTotal(n)}),t.qZA(),t._UZ(2,"mat-divider"),t.qZA()}if(2&e){const o=r.$implicit,i=r.index;t.xp6(1),t.Q6J("producto",o)("posicion",i)}}function k(e,r){if(1&e){const o=t.EpF();t.YNc(0,q,3,2,"div",6),t.TgZ(1,"h2",7),t._uU(2," Total: "),t.TgZ(3,"h5"),t._uU(4),t.ALo(5,"currency"),t.qZA()(),t.TgZ(6,"button",8),t.NdJ("click",function(){return t.CHM(o),t.oxw().comprar()}),t._uU(7,"Comprar"),t.qZA()}if(2&e){const o=t.oxw();t.Q6J("ngForOf",o.productos),t.xp6(4),t.hij(" ",t.lcZ(5,2,o.priceTotal)," ")}}let G=(()=>{class e{constructor(o,i,n,s){this.authService=o,this.productosService=i,this.router=n,this.cdref=s,this.productos=[],this.confirmacion=!1,this.editarHabilitado=!1,this.editarr="",this.total=[],this.priceTotal=0}ngOnInit(){this.productosService.usuario$.subscribe(o=>{this.usuario=this.authService.usuario,this.index=this.productos.findIndex(i=>i._id==o),this.productos.splice(this.index,1),this.total.splice(this.index,1),this.sumarPrecios()}),this.usuario=this.authService.usuario,console.log(this.usuario),this.buscarProductos()}buscarProductos(){this.usuario.carrito.map(o=>{this.productosService.getProductoID(o.IDproducto).subscribe(i=>{this.productos.push(i)})})}comprar(){this.productosService.procesarCompra(this.usuario.uid,this.usuario).subscribe(o=>{console.log(o),!0===o.ok&&(this.usuario.precio=this.priceTotal,this.productosService.agregarCompra(this.usuario.uid,this.usuario).subscribe(i=>{this.authService.validarToken().subscribe(),this.productosService.vaciarCarrito(this.usuario.uid,this.usuario).subscribe(n=>this.router.navigateByUrl("/home/compras"))})),C().fire({icon:"success",text:"Compra realizada con exito!"})},o=>{console.log(o),C().fire({icon:"error",title:"Oops...",text:o.error.msg})})}precioTotal(o){this.total[o.index]=o.precio,this.sumarPrecios()}sumarPrecios(){this.priceTotal=this.total.reduce((o,i)=>o+i,0),this.cdref.detectChanges()}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(f.e),t.Y36(l.k),t.Y36(d.F0),t.Y36(t.sBO))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-carrito"]],viewQuery:function(o,i){if(1&o&&t.Gf(D,5),2&o){let n;t.iGM(n=t.CRH())&&(i.miFormulario=n.first)}},decls:8,vars:2,consts:[["fxLayout","column",1,"container"],["fxLayoutAlign","center"],["fxLayout","column"],["fxLayoutAlign","center",4,"ngIf","ngIfElse"],["divProducto",""],["fxLayoutAlign","center center"],[4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","center center"],["mat-button","",1,"comprar",3,"click"],[3,"producto","posicion","price"]],template:function(o,i){if(1&o&&(t.TgZ(0,"div",0)(1,"h1",1),t._uU(2,"Carrito"),t.qZA(),t._UZ(3,"mat-divider"),t.TgZ(4,"div",2),t.YNc(5,Q,3,0,"div",3),t.YNc(6,k,8,4,"ng-template",null,4,t.W1O),t.qZA()()),2&o){const n=t.MAs(7);t.xp6(5),t.Q6J("ngIf",0==i.productos.length)("ngIfElse",n)}},directives:[p.xw,p.Wh,v.d,c.O5,c.sg,E,g.lW],pipes:[c.H9],styles:[".container[_ngcontent-%COMP%]{background-color:#fff;margin:15px;border-radius:10px}.comprar[_ngcontent-%COMP%]{margin-top:10px;background-color:#6016fd;color:#fff}img[_ngcontent-%COMP%]{width:150px;height:150px}mat-divider[_ngcontent-%COMP%]{width:100%}h2[_ngcontent-%COMP%]{margin-block:0px;margin:10px;padding-right:10%}h5[_ngcontent-%COMP%]{display:flex;align-items:flex-end;margin-block:0px;margin-left:10px;font-size:20px;font-family:Trebuchet MS,Lucida Sans Unicode,Lucida Grande,Lucida Sans,Arial,sans-serif}"]}),e})();var m=a(1125),W=a(4766);function z(e,r){1&e&&(t.TgZ(0,"div"),t._UZ(1,"mat-spinner"),t.qZA())}function B(e,r){if(1&e){const o=t.EpF();t.TgZ(0,"mat-card",2)(1,"h4",3),t._uU(2),t.qZA(),t.TgZ(3,"button",4),t.NdJ("click",function(){return t.CHM(o),t.oxw().verProducto()}),t._uU(4," Ver Producto "),t.qZA(),t.TgZ(5,"span",5),t._uU(6),t.ALo(7,"i18nPlural"),t.ALo(8,"currency"),t.qZA()()}if(2&e){const o=t.oxw();t.xp6(2),t.Oqu(o.producto.name),t.xp6(4),t.AsE(" ",t.xi3(7,3,o.ID.unidades,o.ProductoMapa)," | ",t.lcZ(8,6,o.producto.price*o.ID.unidades)," ")}}let R=(()=>{class e{constructor(o,i){this.productosServices=o,this.router=i,this.ProductoMapa={"=1":"1 producto",other:"# productos"},this.url=W.N.baseUrl+"/home"}ngOnInit(){this.productosServices.getProductoID(this.ID.IDproducto).subscribe(o=>{this.producto=o})}verProducto(){this.router.navigateByUrl(`home/${this.producto.categoria}/${this.producto.name}`)}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(l.k),t.Y36(d.F0))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-tarjeta-compras"]],inputs:{ID:"ID"},decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["divPro",""],["fxLayout","row","fxFlex","100",1,"producto"],["fxFlex","30"],["mat-button","","fxFlex","20",1,"button",3,"click"],["fxFlex","50"]],template:function(o,i){if(1&o&&(t.YNc(0,z,2,0,"div",0),t.YNc(1,B,9,8,"ng-template",null,1,t.W1O)),2&o){const n=t.MAs(2);t.Q6J("ngIf",!i.producto)("ngIfElse",n)}},directives:[c.O5,T.Ou,_.a8,p.xw,p.yH,g.lW],pipes:[c.Gx,c.H9],styles:['h4[_ngcontent-%COMP%]{margin-block:0}span[_ngcontent-%COMP%]{margin-left:10px}.producto[_ngcontent-%COMP%]{display:flex;align-items:center}.mat-card[_ngcontent-%COMP%]:not([class*="mat-elevation-z"]){box-shadow:0 2px 1px 3px #0003,0 1px 1px 1px #00000024,0 1px 3px 1px #0000001f!important}.button[_ngcontent-%COMP%]{color:#3c00bb;font-weight:700;display:flex;justify-content:center}']}),e})();function X(e,r){1&e&&(t.TgZ(0,"div",2)(1,"h1"),t._uU(2,"No tiene compras realizadas"),t.qZA()())}function $(e,r){if(1&e&&(t.TgZ(0,"div"),t._UZ(1,"app-tarjeta-compras",13),t.qZA()),2&e){const o=r.$implicit;t.xp6(1),t.Q6J("ID",o)}}function K(e,r){if(1&e&&(t.TgZ(0,"div",8)(1,"mat-expansion-panel",9)(2,"mat-expansion-panel-header")(3,"mat-panel-title",10),t._uU(4),t.ALo(5,"date"),t.qZA(),t.TgZ(6,"mat-panel-description",11),t._uU(7),t.ALo(8,"i18nPlural"),t.ALo(9,"currency"),t.qZA()(),t.TgZ(10,"div"),t.YNc(11,$,2,1,"div",12),t.qZA()()()),2&e){const o=r.$implicit,i=r.index,n=t.oxw(2);t.xp6(4),t.hij(" Fecha: ",t.xi3(5,5,o.fecha,"d/M/yy, H:mm ")," "),t.xp6(3),t.lnq(" ",n.verUnidades(i,o)," ",t.xi3(8,8,n.unidades[i],n.compraMapa)," | ",t.lcZ(9,11,o.precio)," "),t.xp6(4),t.Q6J("ngForOf",o.compra)}}function V(e,r){if(1&e&&(t.TgZ(0,"div",6),t.YNc(1,K,12,13,"div",7),t.qZA()),2&e){const o=t.oxw();t.xp6(1),t.Q6J("ngForOf",o.compras)}}const tt=[{path:"",component:M,children:[{path:"carrito",component:G},{path:"compras",component:(()=>{class e{constructor(o,i,n){this.authService=o,this.cdref=i,this.productosServices=n,this.compras=[],this.productos=[],this.index=0,this.unidades=[],this.compraMapa={"=1":"1 producto",other:"# productos"}}ngOnInit(){this.usuario=Object.assign({},this.authService.usuario),this.buscarCompras(),this.compras.reverse(),console.log(this.compras.length)}buscarCompras(){var o;null===(o=this.usuario.compras)||void 0===o||o.map(i=>this.compras.push(i))}buscarProductos(o){o.compra.map(i=>{let n=this.productos.findIndex(s=>s._id==i.IDproducto);-1!=n?this.index=n:this.productosServices.getProductoID(i.IDproducto).subscribe(s=>{this.productos.push(s);let h=this.productos.findIndex(nt=>nt._id==i.IDproducto);this.index=h})})}verUnidades(o,i){let n=0;i.compra.map(s=>{n+=s.unidades}),this.unidades[o]=n}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(f.e),t.Y36(t.sBO),t.Y36(l.k))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-compras"]],decls:9,vars:2,consts:[["fxLayoutAlign","center center"],["fxLayout","column","fxFlex.xs","100","fxFlex.sm","70","fxFlex","55",1,"container"],["fxLayoutAlign","center"],["fxLayout","column"],["fxLayoutAlign","center",4,"ngIf","ngIfElse"],["divCompra",""],["fxLayout","row wrap","fxLayoutAlign","center center","fxFlex","100",1,"pepe"],["fxFlex","100",4,"ngFor","ngForOf"],["fxFlex","100"],["hideToggle",""],["fxFlex","40"],["fxFlex","60"],[4,"ngFor","ngForOf"],[3,"ID"]],template:function(o,i){if(1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h1",2),t._uU(3,"Compras"),t.qZA(),t._UZ(4,"mat-divider"),t.TgZ(5,"div",3),t.YNc(6,X,3,0,"div",4),t.YNc(7,V,2,1,"ng-template",null,5,t.W1O),t.qZA()()()),2&o){const n=t.MAs(8);t.xp6(6),t.Q6J("ngIf",0==i.compras.length)("ngIfElse",n)}},directives:[p.Wh,p.xw,p.yH,v.d,c.O5,c.sg,m.ib,m.yz,m.yK,m.u4,R],pipes:[c.uU,c.Gx,c.H9],styles:[".container[_ngcontent-%COMP%]{background-color:#fff;margin:10px 0;border-radius:10px}mat-panel-description[_ngcontent-%COMP%]{color:#000000d6}"]}),e})()},{path:":name",component:I,children:[{path:"",component:O.n},{path:":name",component:b.g}]},{path:"",component:A.p}]}];let ot=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[d.Bz.forChild(tt)],d.Bz]}),e})();var et=a(9258);let it=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[c.ez,ot,y.q,u.u5,Z.o9,et.K,u.UX]]}),e})()}}]);